digraph {
    label="an staker upgrades their wallet to new treasury"
    node [ colorscheme=pastel19 style=filled ]

    /* Entities */
    external [ shape=point ]
    staker [ color=2 ]
    wallet_old, wallet_new [ color=3 ]
    treasury_old, treasury_new [ color=4 ]

    /* Relationships */
    staker -> wallet_old [ arrowhead=inv style=dotted ]
    staker -> wallet_new [ arrowhead=inv style=dotted ]
    external -> staker [ label="1" ]
    staker -> wallet_old [ label="2\l op::upgrade_wallet\l 0.10 TON\l" ]
    wallet_old -> treasury_old [ label="3\l op::convert_wallet\l 0.14 TON\l" ]
    treasury_old -> treasury_new [ label="4\l op::migrate_wallet\l 0.13 TON\l" ]
    treasury_new -> wallet_new [ label="5\l op::merge_wallet\l 0.12 TON\l" ]
    wallet_new -> staker [ label="6\l op::gas_excess\l 0.06 TON\l" ]

    /* Ranks */
    { rank=min external staker }
    { rank=max treasury_old treasury_new }
}
